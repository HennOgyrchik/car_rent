# Расчет стоимости аренды автомобилей
В сервисе ведется бронирование автомобилей, подсчет стоимости и возможность
бронирования.
Нас интересуют только бронирования, поэтому предполагаем, что клиенты и машины
обрабатываются в другом сервисе, а для нашего сервиса только id машины.

Ограничения:
-  автомобили бронируются на период от 1го до 30 дней
-  между окончанием
   бронирования и началом следующего должен быть интервал 3 дня
- начало и конец аренды может выпадать только на будние дни (пн-пт)
- парк автомобилей - 5 автомобилей
- в зависимости от
  длительности бронирования изменяется стоимость дня аренды. Базовый тариф - 1000 ₽ в день
  -- с 1-го по 4-й день - базовый
  -- с 5-го по 9-й день - базовый - 5%
  -- с 10-го по 17-й день - базовый - 10%
  -- с 18-го по 30-й день - базовый - 15%
- Запись бронирования может быть произведена в прошлом и будущем

## Сборка и запуск
```sh
git clone https://github.com/HennOgyrchik/car_rent.git
cd car_rent
docker compose up
```
### Environments
- WEB_HOST - адрес веб-сервера
- WEB_PORT - порт веб-сервера
- SERVICE_BASE_COST - базовый тариф аренды
- SERVICE_INTERVAL - интервал между арендами
- SERVICE_MAX_RENT_PERIOD - максимальный срок аренды
- PSQL_HOST - адрес PostgreSQL
- PSQL_PORT - порт PostgreSQL
- PSQL_NAME - название базы данных
- PSQL_USER - имя пользователя
- PSQL_PASSWORD - пароль
- PSQL_SSL_MODE - ssl mode
- PSQL_CONN_TIMEOUT - таймаут подключения к БД


## Endpoints
1. `GET /rent/calculate/{count}` - подсчет стоимости аренды, где {count} - кол-во дней
```json
Ответ: 
{
    "Cost": 8750
}
```
2. `POST /rent` - бронирование машины

```json
Запрос:
{
    "car_number":"A111AA111",
    "start": "2024-08-27",
    "stop": "2024-09-10"
}

Ответ:

{
    "Cost": 14150
}
```


3. `PUT /rent/check` - проверка доступности автомобиля для аренды
 ```json
 Запрос:
 {
    "car_number":"E555EE555",
    "start": "2024-08-09",
    "stop": "2024-08-23"
}

Ответ:
{
    "Available": true
}
 ```

4. `GET /rent/report/{date}` - отчет за месяц, где {date} - дата в формате yyyy-mm-dd
```json
{
    "by_car": {
        "A111AA111": 33.33,
        "B222BB222": 13.33
    },
    "summary": {
        "cars": 2,
        "average": 23.33
    }
}
```
## Комментарии
1. для тестирования работы, в базу данных при запуске, помещаются готовые записи о пяти автомобилях (ознакомиться со списком можно в файле миграции)
2. так как для получения отчета за месяц важно знать только год и месяц, указанное в запросе число месяца не играет роли. Отчет будет сформирован с 1 числа и до конца месяца
3. отчет предоставляет следующие данные:
   -- раздел  "by_car" - номер машины и процент дней в аренде за месяц (для каждого автомобиля)
   -- раздел  "summary" - кол-во машин и средний процент дней в аренде за месяц
4. ограничение числа машин в парке реализовано средствами БД
5. в случае возникновения каких-либо вопросов связанных с проектом, просьба обращаться в телеграм (@stanley_tweedle)
